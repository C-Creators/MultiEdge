---
// LiveEditor component - only renders for authenticated admins
import { createServerClient } from '../lib/supabase';

const supabase = createServerClient(Astro.cookies);
const accessToken = Astro.cookies.get('sb-access-token')?.value;
const refreshToken = Astro.cookies.get('sb-refresh-token')?.value;

let isAdmin = false;

if (accessToken && refreshToken) {
  const { data } = await supabase.auth.setSession({
    access_token: accessToken,
    refresh_token: refreshToken
  });
  isAdmin = !!data.session;
}
---

{isAdmin && (
  <!-- Edit Mode Toggle -->
  <button id="editModeToggle" class="edit-toggle" title="Toggle Edit Mode">
    <svg class="icon-edit" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
      <path d="m15 5 4 4"/>
    </svg>
    <svg class="icon-eye" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
      <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
      <circle cx="12" cy="12" r="3"/>
    </svg>
    <span class="edit-label">Edit</span>
  </button>

  <!-- Admin Bar -->
  <div id="adminBar" class="admin-bar">
    <div class="admin-bar-left">
      <span class="admin-badge">‚úèÔ∏è Edit Mode</span>
      <span class="admin-hint">Click text to edit ‚Ä¢ Toggle sections below</span>
    </div>
    <div class="admin-bar-right">
      <button id="toggleSectionsBtn" class="admin-btn sections-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
        </svg>
        Sections
      </button>
      <a href="/admin" class="admin-link">Dashboard</a>
      <button id="exitEditMode" class="admin-btn">Exit</button>
    </div>
  </div>

  <!-- Section Visibility Panel -->
  <div id="sectionsPanel" class="sections-panel">
    <div class="sections-panel-header">
      <h4>Section Visibility</h4>
      <button id="closeSectionsPanel" class="panel-close">√ó</button>
    </div>
    <div class="sections-panel-body" id="sectionsList">
      <!-- Sections will be populated by JS -->
    </div>
    <div class="sections-panel-footer">
      <button id="showAllSections" class="panel-btn">Show All</button>
      <button id="saveSectionVisibility" class="panel-btn primary">Save Changes</button>
    </div>
  </div>

  <!-- Popover Editor -->
  <div id="editPopover" class="edit-popover">
    <div class="popover-header">
      <code id="popoverKey"></code>
      <button id="popoverClose" class="popover-close">√ó</button>
    </div>
    <div class="popover-body">
      <div class="popover-field">
        <label><span class="flag">üá∫üá∏</span> English</label>
        <textarea id="popoverEn" rows="2"></textarea>
      </div>
      <div class="popover-field">
        <label><span class="flag">üá™üá∏</span> Spanish</label>
        <textarea id="popoverEs" rows="2"></textarea>
      </div>
    </div>
    <div class="popover-footer">
      <button id="popoverCancel" class="popover-btn cancel">Cancel</button>
      <button id="popoverSave" class="popover-btn save">
        <span class="save-text">Save</span>
        <span class="save-loading" style="display:none">Saving...</span>
      </button>
    </div>
    <div class="popover-arrow"></div>
  </div>

  <!-- Toast Notification -->
  <div id="editToast" class="edit-toast">
    <span id="editToastMsg">Saved!</span>
  </div>

  <script type="module">
  // Import Floating UI from ESM CDN
  import { computePosition, flip, shift, offset, arrow } from 'https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.3/+esm';
  
  // Elements
  const toggle = document.getElementById('editModeToggle');
  const adminBar = document.getElementById('adminBar');
  const popover = document.getElementById('editPopover');
  const popoverKey = document.getElementById('popoverKey');
  const popoverEn = document.getElementById('popoverEn');
  const popoverEs = document.getElementById('popoverEs');
  const popoverArrow = popover.querySelector('.popover-arrow');
  const toast = document.getElementById('editToast');
  const toastMsg = document.getElementById('editToastMsg');
  const sectionsPanel = document.getElementById('sectionsPanel');
  const sectionsList = document.getElementById('sectionsList');
  
  let editMode = false;
  let currentElement = null;
  let currentKey = null;

  // Section definitions with friendly names
  const sectionConfig = {
    'hero': { name: 'Hero', icon: 'üè†' },
    'about': { name: 'About', icon: 'üìã' },
    'philosophy': { name: 'Philosophy', icon: 'üí°' },
    'systems': { name: 'Systems', icon: '‚öôÔ∏è' },
    'brokers': { name: 'Brokers', icon: 'üè¶' },
    'bot': { name: 'Bot Details', icon: 'ü§ñ' },
    'calculator': { name: 'Calculator', icon: 'üßÆ' },
    'audience': { name: 'Audience', icon: 'üë•' },
    'faq': { name: 'FAQ', icon: '‚ùì' },
    'final-cta': { name: 'Final CTA', icon: 'üì¢' },
  };

  // Load section visibility from localStorage
  function loadSectionVisibility() {
    const saved = localStorage.getItem('duplifinance-sections');
    return saved ? JSON.parse(saved) : {};
  }

  // Save section visibility to localStorage
  function saveSectionVisibility(visibility) {
    localStorage.setItem('duplifinance-sections', JSON.stringify(visibility));
  }

  // Apply section visibility
  function applySectionVisibility() {
    const visibility = loadSectionVisibility();
    Object.entries(visibility).forEach(([sectionId, isVisible]) => {
      const section = document.getElementById(sectionId);
      if (section) {
        section.style.display = isVisible ? '' : 'none';
        section.dataset.hidden = isVisible ? 'false' : 'true';
      }
    });
  }

  // Initialize section visibility on load
  applySectionVisibility();

  // Populate sections panel
  function populateSectionsPanel() {
    const visibility = loadSectionVisibility();
    const sections = document.querySelectorAll('section[id]');
    
    sectionsList.innerHTML = '';
    
    sections.forEach(section => {
      const id = section.id;
      const config = sectionConfig[id] || { name: id, icon: 'üìÑ' };
      const isVisible = visibility[id] !== false; // Default to visible
      
      const item = document.createElement('div');
      item.className = 'section-item';
      item.innerHTML = `
        <div class="section-item-info">
          <span class="section-icon">${config.icon}</span>
          <span class="section-name">${config.name}</span>
        </div>
        <button class="visibility-toggle ${isVisible ? 'visible' : 'hidden'}" data-section="${id}">
          <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          <svg class="eye-closed" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
            <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
            <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
            <line x1="2" y1="2" x2="22" y2="22"/>
          </svg>
        </button>
      `;
      sectionsList.appendChild(item);
    });

    // Add click handlers
    sectionsList.querySelectorAll('.visibility-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const sectionId = btn.dataset.section;
        const isCurrentlyVisible = btn.classList.contains('visible');
        btn.classList.toggle('visible', !isCurrentlyVisible);
        btn.classList.toggle('hidden', isCurrentlyVisible);
        
        // Preview the change
        const section = document.getElementById(sectionId);
        if (section) {
          section.style.display = isCurrentlyVisible ? 'none' : '';
          section.dataset.hidden = isCurrentlyVisible ? 'true' : 'false';
        }
      });
    });
  }

  // Toggle sections panel
  document.getElementById('toggleSectionsBtn').addEventListener('click', () => {
    sectionsPanel.classList.toggle('open');
    if (sectionsPanel.classList.contains('open')) {
      populateSectionsPanel();
    }
  });

  document.getElementById('closeSectionsPanel').addEventListener('click', () => {
    sectionsPanel.classList.remove('open');
  });

  // Show all sections
  document.getElementById('showAllSections').addEventListener('click', () => {
    sectionsList.querySelectorAll('.visibility-toggle').forEach(btn => {
      btn.classList.add('visible');
      btn.classList.remove('hidden');
      const sectionId = btn.dataset.section;
      const section = document.getElementById(sectionId);
      if (section) {
        section.style.display = '';
        section.dataset.hidden = 'false';
      }
    });
  });

  // Save section visibility
  document.getElementById('saveSectionVisibility').addEventListener('click', () => {
    const visibility = {};
    sectionsList.querySelectorAll('.visibility-toggle').forEach(btn => {
      visibility[btn.dataset.section] = btn.classList.contains('visible');
    });
    saveSectionVisibility(visibility);
    showToast('Section visibility saved!', false);
    sectionsPanel.classList.remove('open');
  });
  
  // Toggle edit mode
  function setEditMode(enabled) {
      editMode = enabled;
      document.body.classList.toggle('live-edit-mode', enabled);
      adminBar.classList.toggle('visible', enabled);
      toggle.querySelector('.icon-edit').style.display = enabled ? 'none' : 'block';
      toggle.querySelector('.icon-eye').style.display = enabled ? 'block' : 'none';
      toggle.querySelector('.edit-label').textContent = enabled ? 'Preview' : 'Edit';
      
      if (!enabled) {
        hidePopover();
      }
    }
    
    toggle.addEventListener('click', () => setEditMode(!editMode));
    document.getElementById('exitEditMode').addEventListener('click', () => setEditMode(false));
    
    // Click on editable elements
    document.addEventListener('click', (e) => {
      if (!editMode) return;
      
      const target = e.target.closest('[data-i18n]');
      if (!target) {
        // Clicked outside - close popover if clicking outside of it
        if (!popover.contains(e.target) && !toggle.contains(e.target) && !adminBar.contains(e.target)) {
          hidePopover();
        }
        return;
      }
      
      e.preventDefault();
      e.stopPropagation();
      
      showPopover(target);
    });
    
    // Show popover
    function showPopover(element) {
      currentElement = element;
      currentKey = element.getAttribute('data-i18n');
      
      // Get current values
      const translations = window.__TRANSLATIONS__;
      const [section, ...keyParts] = currentKey.split('.');
      const key = keyParts.join('.');
      
      const getValue = (lang) => {
        try {
          return keyParts.reduce((obj, k) => obj?.[k], translations[lang]?.[section]) || element.textContent;
        } catch {
          return element.textContent;
        }
      };
      
      popoverKey.textContent = currentKey;
      popoverEn.value = getValue('en');
      popoverEs.value = getValue('es');
      
      // Auto-resize textareas
      [popoverEn, popoverEs].forEach(ta => {
        ta.style.height = 'auto';
        ta.style.height = Math.max(60, Math.min(200, ta.scrollHeight)) + 'px';
      });
      
      popover.classList.add('visible');
      
      // Position with Floating UI
      updatePosition();
    }
    
    function updatePosition() {
      if (!currentElement || !popover.classList.contains('visible')) return;
      
      computePosition(currentElement, popover, {
        placement: 'top',
        middleware: [
          offset(12),
          flip({ fallbackPlacements: ['bottom', 'left', 'right'] }),
          shift({ padding: 16 }),
          arrow({ element: popoverArrow })
        ]
      }).then(({ x, y, placement, middlewareData }) => {
        Object.assign(popover.style, {
          left: `${x}px`,
          top: `${y}px`
        });
        
        // Position arrow
        const { x: arrowX, y: arrowY } = middlewareData.arrow || {};
        const staticSide = {
          top: 'bottom',
          right: 'left',
          bottom: 'top',
          left: 'right'
        }[placement.split('-')[0]];
        
        Object.assign(popoverArrow.style, {
          left: arrowX != null ? `${arrowX}px` : '',
          top: arrowY != null ? `${arrowY}px` : '',
          right: '',
          bottom: '',
          [staticSide]: '-6px'
        });
      });
    }
    
    function hidePopover() {
      popover.classList.remove('visible');
      currentElement = null;
      currentKey = null;
    }
    
    // Close button
    document.getElementById('popoverClose').addEventListener('click', hidePopover);
    document.getElementById('popoverCancel').addEventListener('click', hidePopover);
    
    // Escape key closes popover
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && popover.classList.contains('visible')) {
        hidePopover();
      }
    });
    
    // Save
    document.getElementById('popoverSave').addEventListener('click', async () => {
      const saveBtn = document.getElementById('popoverSave');
      const saveText = saveBtn.querySelector('.save-text');
      const saveLoading = saveBtn.querySelector('.save-loading');
      
      saveText.style.display = 'none';
      saveLoading.style.display = 'inline';
      saveBtn.disabled = true;
      
      try {
        const res = await fetch('/api/content/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            [currentKey]: {
              en: popoverEn.value,
              es: popoverEs.value
            }
          })
        });
        
        if (res.ok) {
          // Update displayed text immediately
          const currentLang = document.documentElement.getAttribute('data-lang') || 'en';
          const newValue = currentLang === 'en' ? popoverEn.value : popoverEs.value;
          currentElement.textContent = newValue;
          
          // Update global translations
          const [section, ...keyParts] = currentKey.split('.');
          ['en', 'es'].forEach(lang => {
            let obj = window.__TRANSLATIONS__[lang][section];
            for (let i = 0; i < keyParts.length - 1; i++) {
              obj = obj[keyParts[i]] = obj[keyParts[i]] || {};
            }
            obj[keyParts[keyParts.length - 1]] = lang === 'en' ? popoverEn.value : popoverEs.value;
          });
          
          // Flash success on element
          currentElement.classList.add('edit-saved');
          setTimeout(() => currentElement.classList.remove('edit-saved'), 1500);
          
          showToast('Saved successfully!', false);
          hidePopover();
        } else {
          showToast('Failed to save', true);
        }
      } catch (err) {
        showToast('Error saving', true);
      }
      
      saveText.style.display = 'inline';
      saveLoading.style.display = 'none';
      saveBtn.disabled = false;
    });
    
    // Toast
    function showToast(msg, isError) {
      toastMsg.textContent = msg;
      toast.classList.toggle('error', isError);
      toast.classList.add('visible');
      setTimeout(() => toast.classList.remove('visible'), 2500);
    }
    
    // Textarea auto-resize
    [popoverEn, popoverEs].forEach(ta => {
      ta.addEventListener('input', () => {
        ta.style.height = 'auto';
        ta.style.height = Math.max(60, Math.min(200, ta.scrollHeight)) + 'px';
        updatePosition();
      });
    });
    
    // Reposition on scroll/resize
    let ticking = false;
    const reposition = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updatePosition();
          ticking = false;
        });
        ticking = true;
      }
    };
    window.addEventListener('scroll', reposition, true);
    window.addEventListener('resize', reposition);
  </script>

  <style is:global>
    /* Edit Mode Toggle Button */
    .edit-toggle {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9998;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      background: linear-gradient(135deg, #1a1a2e, #2d2d44);
      color: #fff;
      border: none;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      transition: all 0.2s;
    }
    
    .edit-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,0,0,0.4);
    }
    
    /* Admin Bar */
    .admin-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 9997;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: linear-gradient(135deg, #1a1a2e, #2d2d44);
      color: #fff;
      font-size: 13px;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }
    
    .admin-bar.visible {
      transform: translateY(0);
    }
    
    .admin-bar-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .admin-badge {
      background: rgba(201, 162, 39, 0.2);
      color: #c9a227;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
    }
    
    .admin-hint {
      color: rgba(255,255,255,0.7);
    }
    
    .admin-bar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .admin-link {
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.15s;
    }
    
    .admin-link:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    
    .admin-btn {
      padding: 6px 14px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .admin-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    .admin-btn.sections-btn {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .admin-btn.sections-btn svg {
      opacity: 0.8;
    }

    /* Sections Panel */
    .sections-panel {
      position: fixed;
      top: 52px;
      right: 0;
      width: 320px;
      max-height: calc(100vh - 72px);
      background: #fff;
      border-radius: 0 0 0 12px;
      box-shadow: -4px 4px 20px rgba(0,0,0,0.15);
      z-index: 9996;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      display: flex;
      flex-direction: column;
    }

    .sections-panel.open {
      transform: translateX(0);
    }

    .sections-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 18px;
      border-bottom: 1px solid #e5e7eb;
    }

    .sections-panel-header h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: #1a1a2e;
    }

    .panel-close {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      font-size: 20px;
      color: #9ca3af;
      cursor: pointer;
      border-radius: 6px;
    }

    .panel-close:hover {
      background: #f3f4f6;
      color: #374151;
    }

    .sections-panel-body {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .section-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 6px;
      background: #f9fafb;
      transition: background 0.15s;
    }

    .section-item:hover {
      background: #f3f4f6;
    }

    .section-item-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon {
      font-size: 16px;
    }

    .section-name {
      font-size: 14px;
      font-weight: 500;
      color: #374151;
    }

    .visibility-toggle {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .visibility-toggle:hover {
      background: #fff;
      border-color: #d1d5db;
    }

    .visibility-toggle.visible {
      color: #10b981;
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.08);
    }

    .visibility-toggle.hidden {
      color: #9ca3af;
      background: #f3f4f6;
    }

    .visibility-toggle .eye-open {
      display: block;
    }

    .visibility-toggle .eye-closed {
      display: none;
    }

    .visibility-toggle.hidden .eye-open {
      display: none;
    }

    .visibility-toggle.hidden .eye-closed {
      display: block;
    }

    .sections-panel-footer {
      display: flex;
      gap: 10px;
      padding: 14px 18px;
      border-top: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .panel-btn {
      flex: 1;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      background: #fff;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .panel-btn:hover {
      background: #f3f4f6;
    }

    .panel-btn.primary {
      background: #1a1a2e;
      color: #fff;
      border: none;
    }

    .panel-btn.primary:hover {
      background: #2d2d44;
    }
    
    /* Edit Mode Styles */
    body.live-edit-mode {
      padding-top: 52px;
    }
    
    body.live-edit-mode [data-i18n] {
      position: relative;
      cursor: pointer;
      transition: all 0.15s;
      border-radius: 4px;
    }
    
    body.live-edit-mode [data-i18n]:hover {
      outline: 2px dashed rgba(201, 162, 39, 0.6);
      outline-offset: 4px;
      background: rgba(201, 162, 39, 0.08);
    }
    
    body.live-edit-mode [data-i18n]::after {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 4px;
      pointer-events: none;
    }
    
    [data-i18n].edit-saved {
      animation: editSavedPulse 0.5s ease;
    }
    
    @keyframes editSavedPulse {
      0% { background: rgba(16, 185, 129, 0.3); }
      100% { background: transparent; }
    }
    
    /* Popover */
    .edit-popover {
      position: fixed;
      z-index: 9999;
      width: 360px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.25);
      opacity: 0;
      visibility: hidden;
      transform: scale(0.95);
      transition: all 0.15s ease;
    }
    
    .edit-popover.visible {
      opacity: 1;
      visibility: visible;
      transform: scale(1);
    }
    
    .popover-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .popover-header code {
      font-size: 11px;
      color: #6b7280;
      background: #f3f4f6;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .popover-close {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      font-size: 20px;
      color: #9ca3af;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.15s;
    }
    
    .popover-close:hover {
      background: #f3f4f6;
      color: #374151;
    }
    
    .popover-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .popover-field label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 6px;
    }
    
    .popover-field .flag {
      font-size: 14px;
    }
    
    .popover-field textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.5;
      resize: none;
      transition: all 0.15s;
      box-sizing: border-box;
    }
    
    .popover-field textarea:focus {
      outline: none;
      border-color: #c9a227;
      box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.15);
    }
    
    .popover-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding: 12px 16px;
      border-top: 1px solid #e5e7eb;
      background: #f9fafb;
      border-radius: 0 0 12px 12px;
    }
    
    .popover-btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .popover-btn.cancel {
      background: #fff;
      color: #4b5563;
      border: 1px solid #e5e7eb;
    }
    
    .popover-btn.cancel:hover {
      background: #f3f4f6;
    }
    
    .popover-btn.save {
      background: #1a1a2e;
      color: #fff;
      border: none;
      min-width: 80px;
    }
    
    .popover-btn.save:hover:not(:disabled) {
      background: #2d2d44;
    }
    
    .popover-btn.save:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .popover-arrow {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #fff;
      transform: rotate(45deg);
      box-shadow: -2px -2px 4px rgba(0,0,0,0.05);
    }
    
    /* Toast */
    .edit-toast {
      position: fixed;
      bottom: 90px;
      right: 24px;
      z-index: 10000;
      padding: 12px 20px;
      background: #1a1a2e;
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.25s ease;
    }
    
    .edit-toast.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .edit-toast.error {
      background: #dc2626;
    }
    
    /* Mobile adjustments */
    @media (max-width: 480px) {
      .edit-popover {
        width: calc(100vw - 32px);
        left: 16px !important;
        right: 16px;
      }
      
      .admin-hint {
        display: none;
      }
      
      .edit-toggle .edit-label {
        display: none;
      }
      
      .edit-toggle {
        padding: 12px;
        border-radius: 50%;
      }
    }
  </style>
)}
